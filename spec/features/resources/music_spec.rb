require 'rails_helper'

describe "user can receive a music resource" do
  it "displays song url", :vcr do
    user = create(:user, survey?: true, spotify_token: ENV['SPOTIFY_TEST_TOKEN']) 
    stub_user(user)

    allow_any_instance_of(ResourceFacade).to receive(:suggestion).and_return("music")

    music = Music.new({url: 'www.woo.co', song_name: 'Comfortably Numb', image: 'data:image/png;base64,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', artist_name: 'Pink Floyd'}, user)
    allow_any_instance_of(ResourceFacade).to receive(:resource).and_return(music)
    allow_any_instance_of(ResourceFacade).to receive(:get_resource).and_return(music)

    visit '/boost'

    expect(page).to have_content("Penpal selected the following song to lift your spirits:")
    expect(page).to have_link("Comfortably Numb")
    expect(page).to have_content("Song by: Pink Floyd")
  end
end
